<!DOCTYPE html>
<html lang="en">
<head>
    </head>
<body>

    <div id="app">
        <main class="gallery">
            <div v-if="error" class="error-message">
                {{ error }}  </div>
            <div v-else-if="images.length === 0 && !loading">
                No images found in this folder.
            </div>
            <div v-else-if="loading">
                Loading images...
            </div>
            <div v-else v-for="image in images" :key="image.name" class="image-container">
                <img :src="image.raw_url" :alt="image.name">
                <p>{{ image.name.replace(/\.[^/.]+$/, "") }}</p>
            </div>
        </main>

        </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                images: [],
                error: null,
                loading: false
            },
            mounted() {
                this.loading = true; // Set loading to true while fetching

                const repoOwner = "SteveVercellin";
                const repoName = "image_gallery_rm";
                const branch = "main";
                const folderPath = "LOOPIN";

                const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}?ref=${branch}`;

                fetch(apiUrl)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`); // More descriptive error
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (Array.isArray(data)) { // Check if it's an array (directory)
                            this.images = data
                                .filter(file => file.name.match(/\.(webp|jpg|jpeg|png)$/i))
                                .map(file => ({
                                    name: file.name,
                                    raw_url: `https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/${folderPath}/${file.name}`
                                }));
                        } else if (data && data.type === 'file') { // Handle single file
                            this.images = [{
                                name: data.name,
                                raw_url: data.download_url // Use download_url for single files
                            }];
                        } else {
                            throw new Error("Unexpected data format from GitHub API.");
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching images:", error);
                        this.error = error.message; // Display the error message
                    })
                    .finally(() => {
                        this.loading = false; // Set loading to false regardless of success/failure
                    });
            }
        });
    </script>

</body>
</html>